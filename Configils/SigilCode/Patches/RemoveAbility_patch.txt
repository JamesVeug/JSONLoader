// Using Inscryption
using DiskCardGame;
using HarmonyLib;
using JLPlugin.Data;
// Modding Inscryption
using System;

namespace JLPlugin.SigilCode
{

    [HarmonyPatch(typeof(CardTriggerHandler), "RemoveAbility", new Type[]
    {
        typeof(Ability)
    })]
    public class Remove_Ability_patch
    {
        [HarmonyPrefix]
        public static bool Prefix(Ability ability, CardTriggerHandler __instance)
        {

            if (!SigilDicts.ArgumentList.ContainsKey(AbilitiesUtil.GetInfo(ability).rulebookName))
            {
                return true;
            }

            Type SigilType = SigilDicts.ArgumentList[AbilitiesUtil.GetInfo(ability).rulebookName].Item1;

            if (SigilType != null)
            {
                (__instance.GetComponent(SigilType) as ConfigurableBase).ability_list.Remove(ability);
            }

            Tuple<Ability, AbilityBehaviour> tuple = __instance.triggeredAbilities.Find((Tuple<Ability, AbilityBehaviour> x) => x.Item1 == ability);
            if (tuple != null)
            {
                Object.Destroy(tuple.Item2);
                __instance.triggeredAbilities.Remove(tuple);
            }
            return false;
        }
    }
}